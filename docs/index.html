
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Google Cloud Workshop</title>
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style is="custom-style">
    body {
      font-family: "Roboto",sans-serif;
      background: var(--google-codelab-background, #F8F9FA);
    }
  </style>
  
</head>
<body unresolved class="fullbleed">

  <google-codelab title="Google Cloud Workshop"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introduction" duration="0">
        <h2>What you need</h2>
<ul>
<li>A Gmail account</li>
<li>Google Cloud SDK installed on your local machine</li>
</ul>
<h2 class="checklist">What you&#39;ll learn</h2>
<ul class="checklist">
<li>Basics of Google Cloud</li>
<li>How to set up and use Cloud SQL with a client</li>
<li>Create and interact with your first GCS bucket using the UI and Command Line tool</li>
<li>Create a Pubsub topic and subscription</li>
<li>Create a Google Compute Engine instance</li>
<li>Deploy an application in GCE</li>
<li>Monitoring your application</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Setup and Requirements" duration="0">
        <h2>Project</h2>
<h3>What is Project</h3>
<p>A project organizes all your Google Cloud Platform resources. A project consists of a set of users; a set of APIs; and billing, authentication, and monitoring settings for those APIs. So, for example, all of your Cloud Storage buckets and objects, along with user permissions for accessing them, reside in a project. You can have one project, or you can create multiple projects.</p>
<h3>Create a Project</h3>
<p>If you don&#39;t already have a Google Account (Gmail or Google Apps), you must <a href="https://accounts.google.com/SignUp" target="_blank">create one</a>. Sign-in to Google Cloud Platform console (<a href="http://console.cloud.google.com/" target="_blank">console.cloud.google.com</a>) and create a new project:</p>
<p><img style="max-width: 278.00px" src="img/fabfa63af191ac0c.png"></p>
<p><img style="max-width: 544.00px" src="img/7c3caa4c26a21879.png"></p>
<p>Remember the project ID, a unique name across all Google Cloud projects (the name above has already been taken and will not work for you, sorry!). It will be referred to later in this workshop as <strong><code>PROJECT_ID</code></strong>.</p>
<h3>Enable Billing</h3>
<p>Next, you&#39;ll need to <a href="https://console.developers.google.com/billing" target="_blank">enable billing</a> in the Developers Console in order to use Google Cloud resources and <a href="https://console.developers.google.com/flows/enableapi?apiid=compute_component" target="_blank">enable the Compute Engine API</a>.</p>
<p>New users of Google Cloud Platform are eligible for a <a href="https://console.developers.google.com/billing/freetrial?hl=en" target="_blank">$300 free trial</a>.</p>
<h2>Cloud Shell</h2>
<h3>Activate Google Cloud Shell</h3>
<p>From the GCP Console click the Cloud Shell icon on the top right toolbar:</p>
<p><img style="max-width: 276.00px" src="img/d49d6f994f9d1089.png"></p>
<p>Then click &#34;Start Cloud Shell&#34;:</p>
<p><img style="max-width: 675.07px" src="img/30dfb7e88dc693cb.png"></p>
<p>It should only take a few moments to provision and connect to the environment:</p>
<p><img style="max-width: 624.00px" src="img/638582c3614433f3.png"></p>
<p>Once connected to the cloud shell, you should see that you are already authenticated and that the project is already set to your <em>PROJECT_ID</em>.</p>
<p>Run the following command in the cloud shell to confirm that you are authenticated:</p>
<pre>gcloud auth list</pre>
<p><strong>Command output</strong></p>
<pre>Credentialed accounts:
 - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</pre>
<p>Run the following command in the cloud shell to list out the projects:</p>
<pre>gcloud config list project</pre>
<p><strong>Command output</strong></p>
<pre>[core]
project = &lt;PROJECT_ID&gt;</pre>
<p>If it is not, you can set it with this command:</p>
<pre>gcloud config set project &lt;PROJECT_ID&gt;</pre>
<h2>Google Cloud SDK</h2>
<p>The Cloud SDK is a set of tools for Cloud Platform. It contains gcloud, gsutil, and bq, which you can use to access Compute Engine, Cloud Storage, BigQuery, and other products and services from the command-line. You can run these tools interactively or in your automated scripts.</p>
<p><a href="https://cloud.google.com/sdk/docs/quickstarts" target="_blank"><paper-button class="colored" raised>Install Cloud SDK</paper-button></a></p>


      </google-codelab-step>
    
      <google-codelab-step label="RDBMS in GCP" duration="0">
        <h2>What is RDBMS in GCP</h2>
<p>RDBMS in GCP  is a fully managed database service that makes it easy to set up, maintain, manage, and administer your relational databases in the cloud. Google Cloud SQL offers high performance, scalability, and convenience and it provides a database infrastructure for applications running anywhere. Google Cloud SQL Currently supports MySQL and POSTGRES.</p>
<h2>Setting Up CloudSQL (Postgres)</h2>
<h3>Step 1</h3>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select SQL in the Storage subsection.</p>
<p><img style="max-width: 484.00px" src="img/3163f82862c79110.png"></p>
<p>You should now see the Cloud SQL web UI, and assuming you are using a project that does not currently have any Cloud SQL instances, you will see a dialog box inviting you to create a new Cloud SQL instance.</p>
<p><img style="max-width: 624.00px" src="img/58bf3f6286adb67b.png"></p>
<h3>Step 2</h3>
<p>Click <strong>Create Instance</strong>. Select Which database you want to use. Currently, It supports Only <strong>Mysql</strong> and <strong>PostgreSQL. </strong>This will take you to the <em>Create an instance</em> page.</p>
<p><img style="max-width: 482.00px" src="img/f03219b4080eb919.png"></p>
<h3>Step 3</h3>
<p>Here you must specify a name for your instance. This name must be unique within your project. You have to configure the password for the admin user and database region. </p>
<p><img style="max-width: 480.00px" src="img/d32055a3e09ddebe.png"></p>
<p>Additionally, you can configure the machine type and storage capacity and other database flags by clicking on <strong>show configuration options. </strong>Once you are done with </p>
<p><img style="max-width: 494.00px" src="img/bc6a1114765cc1c6.png"></p>
<p><img style="max-width: 470.00px" src="img/89941cd1d14ce8b8.png"></p>
<p><strong>Click on Create. </strong></p>
<p><img style="max-width: 483.00px" src="img/cf0436463437b61c.png"></p>
<p>You will be taken to the <em>Instances</em> page, where you will see your new instance with a spinner on the left, indicating it is still being created:</p>
<p><img style="max-width: 624.00px" src="img/49f58f841cc7397d.png"></p>
<p>In two or three minutes, the instance will be available, and a green checkmark will replace the blue spinner. Make sure to refresh the page from time to time:</p>
<p><img style="max-width: 624.00px" src="img/517f792482e09ef4.png"></p>
<p><strong>Your Cloud SQL instance is now ready to use.</strong></p>
<h2>Connection Options</h2>
<p>Currently, there are 3 ways of connecting to Cloud SQL:</p>
<ul>
<li>Through Private IP Address on a <a href="https://cloud.google.com/vpc/" target="_blank">VPC</a></li>
<li>Through the <a href="https://github.com/GoogleCloudPlatform/cloudsql-proxy" target="_blank">Cloud SQL Proxy</a></li>
<li>Through Public IP Address</li>
</ul>
<h2>Connection &amp; Data Manipulation</h2>
<h3>Connection through Cloud Shell</h3>
<h3>Step 1</h3>
<p>Activate Google Cloud Shell by pressing the prompt button in the Google Cloud Console.</p>
<h3>Step 2</h3>
<p>Connect to your Cloud SQL instance using the gcloud beta sql command shown below, but replace <strong>&#34;imaginea-gc-workshop&#34;</strong> with the name of your instance, if different and enter password</p>
<p>gcloud sql connect imaginea-gc-workshop --user=postgres</p>
<p><strong>Command output</strong></p>
<pre>Whitelisting your IP for incoming connection for 5 minutes...done.
Connecting to database with SQL user [postgres].Password for user postgres:
psql (9.6.10, server 9.6.6)
SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES128-GCM-SHA256, bits: 128, compression: off)
Type &#34;help&#34; for help.

postgres=&gt;</pre>
<p>Run the following command in the cloud shell to create database</p>
<pre>create database gc_demo;</pre>
<p><strong>Command output</strong></p>
<pre>CREATE DATABASE</pre>
<p>Run the following command in the cloud shell to change database and enter the password in the prompt</p>
<pre>\c gc_demo</pre>
<p><strong>Command output</strong></p>
<pre>CREATE DATABASE</pre>
<p>Run the following commands to create and view tables.</p>
<pre># List available databases
\l

# List available tables
\dt

# List available schema in the connected database
\dn

CREATE TABLE guestbook (guestName VARCHAR(255), content VARCHAR(255), entryID SERIAL PRIMARY KEY);
INSERT INTO guestbook (guestName, content) values (&#39;first guest&#39;, &#39;I got here!&#39;);
INSERT INTO guestbook (guestName, content) values (&#39;second guest&#39;, &#39;Me too!&#39;);
SELECT * FROM guestbook;
</pre>
<h3>Connection through Cloud SQL Proxy</h3>
<p>The Cloud SQL Proxy is a secure way to connect to your Cloud SQL instance.</p>
<h3>Step 1 - Install the Proxy</h3>
<p><a href="https://cloud.google.com/sql/docs/mysql/sql-proxy#install" target="_blank">Download</a> the Cloud SQL Proxy accordingly to your Operating System. In the following example we are using Linux 64-bit and make it executable with the following commands:</p>
<pre>wget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 -O cloud_sql_proxy

chmod +x cloud_sql_proxy</pre>
<h3>Step 2 - Creating Service Account for use on the Proxy</h3>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select <strong>IAM &amp; ADMIN &gt; Service Accounts</strong>.</p>
<p><img style="max-width: 470.00px" src="img/5ae27dd0ddcf4a3e.png"></p>
<p>Click <strong>Create service account</strong>.</p>
<p><img style="max-width: 624.00px" src="img/dce5e0d0db44ba5b.png"></p>
<p>In the Create service account dialog, provide a descriptive name for the service account.</p>
<p><img style="max-width: 617.00px" src="img/82e7c81042a98360.png"></p>
<p>    For <strong>Role</strong>, select one of the following roles:</p>
<ul>
<li><strong>Cloud SQL &gt; Cloud SQL Client</strong></li>
<li><strong>Cloud SQL &gt; Cloud SQL Editor</strong></li>
<li><strong>Cloud SQL &gt; Cloud SQL Admin</strong></li>
</ul>
<p><img style="max-width: 624.00px" src="img/ee2422455971fa9f.png"></p>
<p><img style="max-width: 574.00px" src="img/63f53007c29ff608.png"></p>
<p>Click <strong>Create key</strong> and Choose JSON in the dialog. Click on create  and download the JSON file. Keep the file Securely.</p>
<p><img style="max-width: 566.00px" src="img/87bc52977280b158.png"></p>
<p><img style="max-width: 572.00px" src="img/e188fc4602c9e800.png"></p>
<p><img style="max-width: 624.00px" src="img/2e673d5f9a6fd6c8.png"></p>
<p>Click <strong>Create</strong>.</p>
<h3>Step 3 - Start the proxy</h3>
<p>Run the following command in your terminal to start the proxy.</p>
<pre>./cloud_sql_proxy -instances=&lt;INSTANCE_CONNECTION_NAME&gt;=tcp:5432 \
                  -credential_file=&lt;PATH_TO_KEY_FILE&gt; &amp;</pre>
<h3>Step 4 - Use PGAdmin to connect the proxy sql connection.</h3>


      </google-codelab-step>
    
      <google-codelab-step label="Storage in Cloud" duration="0">
        <h2>What is it?</h2>
<p>Cloud Storage allows world-wide storage and retrieval of any amount of data at any time. You can use Cloud Storage for a range of scenarios including serving website content, storing data for archival and disaster recovery, or distributing large data objects to users via direct download.</p>
<h2>Bucket Creation Using Console</h2>
<h3>Step 1</h3>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select Storage &gt; Browser in the Storage subsection</p>
<p><img style="max-width: 545.00px" src="img/5d6bf7f220e86e91.png"></p>
<h3>Step 2</h3>
<p>Click on<strong> Create Bucket</strong></p>
<h3>Step 3</h3>
<p>Name your bucket, it must be unique across all of GCP, not just your project. Then select Regional as the default storage class. Choose <code>asia-south1</code> as your Region.</p>
<p><img style="max-width: 624.00px" src="img/6d8bb5930c6e4d61.png"></p>
<h3>Step 4</h3>
<p>You have now created your first bucket! Let&#39;s upload some files. You can upload whatever files you want to use.</p>
<p><img style="max-width: 624.00px" src="img/d98c714a2ec93de1.png"></p>
<h3>Step 5</h3>
<p>You can Share your file with a specific user or Group or Public. By editing permission of the file you can do this. </p>
<p><img style="max-width: 624.00px" src="img/48b678e420113f94.png"></p>
<p><img style="max-width: 500.00px" src="img/b7dcbc905379a5b9.png"></p>
<h2>Create a second GCS bucket using the command line tool, gsutil</h2>
<p>To create a second GCS bucket using the gsutil command use your local terminal environment with the GCP SDK installed, or use the Google Cloud Shell which has all of the SDK tools pre-installed.</p>
<h3>Step 1</h3>
<p>Open the Google Cloud Shell</p>
<p><img style="max-width: 319.00px" src="img/56c39f30d1bab9b3.png"></p>
<h3>Step 2</h3>
<p>Use gsutil to create a new regional bucket in asia-south1</p>
<p>Run the following command in cloud console to create the bucket.</p>
<pre>gsutil mb -c regional -l asia-south1 gs://&lt;Bucket Name&gt;
Bucket Creation</pre>
<h3>Step 3</h3>
<p>Use the gsutil cp command to copy the image from the location where you saved it to the bucket you created</p>
<pre>gsutil cp Desktop/kitten.png gs://&lt;Bucket Name&gt;</pre>
<h3>Step 4</h3>
<p>Use the gsutil ls command to list the contents at the top level of your bucket:</p>
<pre>gsutil ls gs://&lt;Bucket Name&gt;</pre>


      </google-codelab-step>
    
      <google-codelab-step label="Messaging in Cloud" duration="0">
        <h2>Introduction</h2>
<p>Messaging is a technology that enables high-speed, asynchronous, program-to-program communication with reliable delivery. Programs communicate by sending packets of data called messages to each other. Google Cloud Pub/Sub is a fully-managed real-time messaging service that allows you to send and receive messages between independent applications.</p>
<h2>Create a topic and subscription Using Console</h2>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select Pub/Sub in the Bigdata subsection</p>
<p><img style="max-width: 480.00px" src="img/873d80f67617ea21.png"></p>
<p>Click <strong>Enable API</strong></p>
<h3><img style="max-width: 483.00px" src="img/c4c32aa8505dc465.png"></h3>
<p>Click <strong>Create Topic</strong></p>
<p><img style="max-width: 453.00px" src="img/f0c3928c7eb69963.png"></p>
<p>Type the name of the topic and then click <strong>Create</strong>.</p>
<p><img style="max-width: 510.00px" src="img/3dd18d3965404b15.png"></p>
<p>After the topic is created, remain on the Topics page. Look for the topic you just created, press the three vertical dots at the end of the line and click <strong>New Subscription</strong>.</p>
<p><img style="max-width: 624.00px" src="img/fdb6ffcba1bf276e.png"></p>
<p>Type the subscription name in the text box and click <strong>Create</strong>.</p>
<p><img style="max-width: 519.00px" src="img/3055bf45a18e3554.png"></p>
<h2>Create a topic and subscription Using Cloud Shell</h2>
<p>From the te you just set up, create a topic.</p>
<pre>gcloud pubsub topics create &lt;Topic Name&gt;</pre>
<p>Create a subscription attached to this topic:</p>
<pre>gcloud beta pubsub subscriptions create &lt;Subscription Name&gt; --topic &lt;Topic Name&gt;</pre>
<h2>Publish Message</h2>
<p>In the Cloud Pub/Sub topics page, Look for the topic you just created,  press the three vertical dots at the end of the line and click <strong>Publish Message</strong></p>
<p><img style="max-width: 624.00px" src="img/97b33e20f46ebb76.png"></p>
<p>Enter <code>Hello World</code> in the <strong>Message</strong> field and Click <strong>Publish</strong></p>
<p><img style="max-width: 492.00px" src="img/a9f0647e4c2d0a22.png"></p>
<h2>Pull Messages</h2>
<p>Open the Cloud Shell and Enter the following</p>
<pre>gcloud pubsub subscriptions pull --auto-ack &lt;Subscription Name&gt;</pre>
<p>The message you sent appears in the DATA field of the <strong>command output.</strong></p>
<pre>┌─────────────┬─────────────────┬────────────┐
│     DATA    │    MESSAGE_ID   │ ATTRIBUTES │
├─────────────┼─────────────────┼────────────┤
│ Hello World │ 287821426252241 │            │
└─────────────┴─────────────────┴────────────┘</pre>


      </google-codelab-step>
    
      <google-codelab-step label="Developing, Deploying and Monitoring in the Cloud" duration="0">
        <h2>Introduction</h2>
<p>In this workshop, you will learn how to:</p>
<ul>
<li>Deploy your app to Google Compute Engine instances</li>
<li>Set up load balancing and autoscaling for your app</li>
</ul>
<h2>Creating a build to upload to Cloud Storage</h2>
<p>For the purposes of this workshop, you can build the release locally and upload it to Cloud Storage:</p>
<ol type="1" start="1">
<li>Click the following link to download all the code for this workshop:</li>
</ol>
<p><a href="https://github.com/nagaraj-shan-ph/google-cloud-workshop/archive/master.zip" target="_blank"><paper-button class="colored" raised><iron-icon icon="file-download"></iron-icon>Download Zip</paper-button></a></p>
<ol type="1" start="2">
<li>Extract the source code.</li>
<li>Open your terminal and go to the extracted folder</li>
<li>Goto <strong>sample-app-&gt;java</strong></li>
<li>Build the Spring Boot application by running the following command from the root of your application folder</li>
</ol>
<pre>gradle clean build -x text</pre>
<ol type="1" start="6">
<li>Upload the app to Cloud Storage</li>
</ol>
<pre>gsutil cp build/libs.* gs://&lt;BucketName&gt;/demo.jar</pre>
<h2>Deploying your application to a single instance</h2>
<p>Compute Engine instances might provide a startup script that is executed whenever the instance is started or restarted. You use this to install and start your app.</p>
<h2>Enable required API&#39;s</h2>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select <strong>APIs &amp; Services &gt; Dashboard</strong>.</p>
<p><img style="max-width: 441.00px" src="img/2aa17b20937abbc.png"></p>
<p>In the dashboard page Click on <strong>ENABLE APIS AND SERVICES</strong></p>
<p><img style="max-width: 488.00px" src="img/4c7e9f5e6684ccc3.png"></p>
<p>In the result window search for Following APIs and Enable it.</p>
<ol type="1" start="1">
<li>Compute Engine API</li>
<li>Cloud SQL Admin API</li>
<li>Cloud Pub/Sub API</li>
<li>Google Cloud Storage</li>
<li>Google Cloud Storage JSON API</li>
</ol>
<h3>Create a startup script</h3>
<p>Create and run your own startup scripts on your virtual machines to perform automated tasks every time your instance boots up. Create a file called <code>instance-startup.sh</code> in your application&#39;s root directory and copy the following content to it:</p>
<pre>#!/bin/sh

# Set the metadata server to the get projct id
PROJECTID=$(curl -s &#34;http://metadata.google.internal/computeMetadata/v1/project/project-id&#34; -H &#34;Metadata-Flavor: Google&#34;)
BUCKET=$(curl -s &#34;http://metadata.google.internal/computeMetadata/v1/instance/attributes/BUCKET&#34; -H &#34;Metadata-Flavor: Google&#34;)
SQL_INSTANCE=$(curl -s &#34;http://metadata.google.internal/computeMetadata/v1/instance/attributes/SQL_INSTANCE&#34; -H &#34;Metadata-Flavor: Google&#34;)

echo &#34;Project ID: ${PROJECTID} Bucket: ${BUCKET}&#34;

# Get the files we need
  gsutil cp gs://${BUCKET}/demo.jar .

# Install dependencies
sudo apt-get update
sudo apt-get -y --force-yes install openjdk-8-jdk

# Make Java 8 default
sudo update-alternatives --set java /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java

# Download Cloud Proxy and make it executable
wget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 -O cloud_sql_proxy
chmod +x cloud_sql_proxy

# Create Directory for Cloud Sql Proxy Connection
mkdir cloudsql; sudo chmod 777 cloudsql

export APPLICATION_STORAGE  _BUCKET = ${BUCKET}
# Start the Cloud SQL Proxy in the background
./cloud_sql_proxy -dir=/cloudsql -instances=${SQL_INSTANCE}=tcp:5432 &amp;

# Start server
java -jar demo.jar</pre>
<h3>Create and configure a Compute Engine instance Using Console</h3>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select Compute Engine in the Compute subsection.</p>
<p><img style="max-width: 535.00px" src="img/64591ed4e47d4f6b.png"></p>
<p>Click <strong>Create. </strong>It will take you to the Create instance Page</p>
<p><img style="max-width: 427.00px" src="img/3a41d1fdd824ed4d.png"></p>
<p>Here you must specify a name for your instance.  Also you can select the Region, Zone, Machine Type, Boot Disk and Firewall options. And then expand the <strong>Management, Security.. </strong>link.</p>
<p><img style="max-width: 432.00px" src="img/3e72183fd6a68ef9.png"></p>
<p>Configure the following values under Mangement &gt; Metadata section</p>
<ol type="1" start="1">
<li><strong>startup-script-url</strong>=gs://&lt;Bucket Name&gt;/instance-startup.sh</li>
<li><strong>BUCKET</strong>=&lt;Bucket Name&gt;</li>
<li><strong>SQL_INSTANCE</strong>=&lt;SQL Instance Connection Name&gt;</li>
</ol>
<ol type="1" start="1">
<li>You can get this value Under <strong>CloudSQL&gt; Instance&gt; Connect to this Instance</strong></li>
</ol>
<p><img style="max-width: 481.00px" src="img/3a39f6ba58abcebd.png"></p>
<p>Once everything configured Click <strong>Create.</strong></p>
<p><img style="max-width: 470.00px" src="img/f84169fafb26e272.png"></p>
<p>This will take you to the Instances Page and you can see your instance is getting created. Once its create you can see greed tick and your Public and Private IP of the Instance. </p>
<p><img style="max-width: 624.00px" src="img/2117c91aeab0a725.png"></p>
<p>Copy the External IP and We can you it once our Firewall rule is enabled.</p>
<h3>Create a firewall rule to allow traffic to your instance:</h3>
<p>In the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>, click the Menu icon on the top left of the screen and Scroll down and select <strong>VPC network &gt; Firewall </strong>rules  in the <strong>NETWORKING</strong> subsection.</p>
<p><img style="max-width: 469.00px" src="img/560ef9d35da42fe4.png"></p>
<p>In the next Page Click <strong>CREATE FIREWALL RULE.</strong></p>
<p><img style="max-width: 624.00px" src="img/ae7f46b889700767.png"></p>
<p>Enter the firewall rule name.</p>
<p><img style="max-width: 517.00px" src="img/985c3794edfe0d0f.png"></p>
<p>Configure Target tags as <strong><code>http-server</code></strong><strong> </strong>and Source Ip ranges as <strong><code>0.0.0.0/0.</code></strong> In Protocols and ports select <code>tcp</code> and five value as <code>8080</code>. </p>
<p><img style="max-width: 496.00px" src="img/f330322799983114.png"></p>
<p>Click <strong>Create.</strong></p>
<p>To see your application running, visit <code>http://${IP_ADDRESS}:8080/swagger-ui.html</code>, where <code>${IP_ADDRESS}</code> is the external address you obtained above.</p>
<h3>Create and configure a Compute Engine instance Using GCLOUD</h3>
<p>To create a Compute Engine instance, perform the following steps:</p>
<ol type="1" start="1">
<li>Create an instance by running the following command:</li>
</ol>
<pre>gcloud compute create demo-instance \
 --image-project=ubuntu-os-cloud
 --image-family ubuntu-1604-lts \
--zone=asia-south1-b \
--machine-type=n1-standard-1 \
--metadata=BUCKET=imaginea-gc-workshop,SQL_INSTANCE=imaginea-gc-workshop:asia-south1:imaginea-gc-workshop,startup-script-url=gs://imaginea-gc-workshop/instance-startup.sh \
--scopes=userinfo-email,cloud-platform \
--tags=http-server</pre>
<ol type="1" start="2">
<li>This command creates a new instance named <code>demo-instance</code>, grants it access to Cloud Platform services, and provides your startup script. It also sets an instance attribute with the Bucket name.</li>
<li>Check the progress of instance creation:</li>
</ol>
<pre>gcloud compute instances get-serial-port-output demo-instance \
    --zone asia-south-b</pre>
<ol type="1" start="4">
<li>If the startup script has completed, this command returns <code>Finished running startup scripts.</code></li>
<li>Create a firewall rule to allow traffic to your instance:</li>
</ol>
<pre>gcloud compute firewall-rules create default-allow-http-8080 \
    --allow tcp:8080 \
    --source-ranges 0.0.0.0/0 \
    --target-tags http-server \
    --description &#34;Allow port 8080 access to http-server&#34;</pre>
<ol type="1" start="6">
<li>Get the external IP address of your instance:</li>
</ol>
<pre>gcloud compute instances list</pre>
<ol type="1" start="7">
<li>To see your application running, visit <code>http://${IP_ADDRESS}:8080/message</code>, where <code>${IP_ADDRESS}</code> is the external address you obtained above.</li>
</ol>
<h2>Horizontal scaling with multiple instances</h2>
<p>Compute Engine can easily scale horizontally. By using a managed instance group and the Compute Engine autoscaler, Compute Engine can automatically create new instances of your application when needed, and shut down instances when demand is low. You can set up an HTTP load balancer to distribute traffic to the instances in a managed instance group.</p>
<h3>Create a managed instance group</h3>
<p>A managed instance group is a group of homogeneous instances based on an instance template. In this section, you create a group of instances running your Spring Boot app.</p>
<ol type="1" start="1">
<li>Create an instance template:</li>
</ol>
<pre>        gcloud compute instance-templates create demo-template \
        --image-project ubuntu-os-cloud \
        --image-family ubuntu-1604-lts \
        --zone asia-south1-b \
        --machine-type n1-standard-1 \
      --metadata BUCKET=imaginea-gc-workshop,SQL_INSTANCE=imaginea-gc-workshop:asia-south1:imaginea-gc-workshop,startup-script-url=gs://imaginea-gc-workshop/instance-startup.sh \
        --scopes userinfo-email,cloud-platform \
        --tags http-server</pre>
<ol type="1" start="2">
<li>Notice that the template provides most of the information needed to create instances.</li>
<li>Next, create an instance group using the template:</li>
</ol>
<pre>    gcloud compute instance-groups managed create demo-group \
    --base-instance-name demo-group \
    --size 2 \
    --template demo-template \
    --zone asia-south1-b</pre>
<ol type="1" start="4">
<li>The <code>size</code> parameter specifies the number of instances in the group. You can set it to a different value as needed.</li>
<li>Get the names and external IP addresses of the created instances:</li>
</ol>
<pre>     gcloud compute instances list</pre>
<ol type="1" start="6">
<li>The managed instances in the group have names that start with the base-instance-name, such as <code>demo-group.</code> You can use the names to check the progress of instance creation as you did above with a single instance, and then you can use the IP addresses to see your application running on port 8080 of each instance.</li>
</ol>
<h3>Create a load balancer</h3>
<p>In this section, you create a load balancer to direct traffic automatically to available instances in the group:</p>
<ol type="1" start="1">
<li>Create a health check. The load balancer uses a health check to determine which instances are capable of serving traffic. The health check simply ensures that the server responds:</li>
</ol>
<pre>  gcloud compute http-health-checks create demo-health-check \
    --request-path /health \
    --port 8080</pre>
<ol type="1" start="2">
<li>Create a named port. The HTTP load balancer directs traffic to a port named http, so we map that name to port 8080 to indicate that the instances listen on that port:</li>
</ol>
<pre>  gcloud compute instance-groups managed set-named-ports demo-group \
    --named-ports http:8080 \
    --zone asia-south1-b</pre>
<ol type="1" start="3">
<li>Create a backend service. The backend service is the &#34;target&#34; for load-balanced traffic. It defines the instance group to which traffic should be directed, and which health check to use:</li>
</ol>
<pre>  gcloud compute backend-services create demo-service \
    --http-health-checks demo-health-check \
    --global</pre>
<ol type="1" start="4">
<li>Add your instance group to the backend service:</li>
</ol>
<pre>  gcloud compute backend-services add-backend demo-service \
    --instance-group demo-group \
    --global \
    --instance-group-zone asia-south1-b</pre>
<ol type="1" start="5">
<li>Create a URL map. This defines which URLs should be directed to which backend services. In this sample, all traffic is served by one backend service. If you want to load balance requests between multiple regions or groups, you can create multiple backend services:</li>
</ol>
<pre>  gcloud compute url-maps create demo-service-map \
    --default-service demo-service</pre>
<ol type="1" start="6">
<li>Create a proxy that receives traffic and forwards it to backend services using the URL map:</li>
</ol>
<pre>  gcloud compute target-http-proxies create demo-service-proxy \
    --url-map demo-service-map</pre>
<ol type="1" start="7">
<li>Create a global forwarding rule. This ties a public IP address and port to a proxy:</li>
</ol>
<pre>  gcloud compute forwarding-rules create demo-http-rule \
    --target-http-proxy demo-service-proxy \
    --ports 80 \
    --global</pre>
<ol type="1" start="8">
<li>You are now done configuring the load balancer. It might take a few minutes for it to initialize and get ready to receive traffic. You can check on its progress by running the following command:</li>
</ol>
<pre>  gcloud compute backend-services get-health demo-service \
    --global</pre>
<ol type="1" start="9">
<li>Continue checking until it lists at least one instance in state HEALTHY.</li>
<li>Get the forwarding IP address for the load balancer:</li>
</ol>
<pre>  gcloud compute forwarding-rules list --global</pre>
<ol type="1" start="11">
<li>Your forwarding-rules IP address is in the IP_ADDRESS column.</li>
<li>You can now enter the IP address into your browser and view your load-balanced and autoscaled app running on port 80!</li>
</ol>
<h3>Configure an autoscaler</h3>
<p>As traffic to your site changes, you can adjust the instance group size manually, or you can configure an autoscaler to adjust the size automatically in response to traffic demands.</p>
<p>Create an autoscaler to monitor utilization and automatically create and delete instances up to a maximum of 10:</p>
<pre>  gcloud compute instance-groups managed set-autoscaling demo-group \
    --max-num-replicas 10 \
    --target-load-balancing-utilization 0.6 \
    --zone asia-south1-b</pre>
<p>After a few minutes, if you send traffic to the load balancer, you might see that additional instances have been added to the instance group.</p>
<p>A wide variety of autoscaling policies are available to maintain target CPU utilization and request-per-second rates across your instance groups. For more information, refer to Compute Engine&#39;s <a href="https://cloud.google.com/compute/docs/autoscaler/" target="_blank">autoscaler documentation</a>.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49880327-14', 'auto');

    (function() {
      var gaCodelab = '';
      if (gaCodelab) {
        ga('create', gaCodelab, 'auto', {name: 'codelab'});
      }

      var gaView;
      var parts = location.search.substring(1).split('&');
      for (var i = 0; i < parts.length; i++) {
        var param = parts[i].split('=');
        if (param[0] === 'viewga') {
          gaView = param[1];
          break;
        }
      }
      if (gaView && gaView !== gaCodelab) {
        ga('create', gaView, 'auto', {name: 'view'});
      }
    })();
  </script>

</body>
</html>
